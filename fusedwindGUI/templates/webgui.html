{% extends "base.html" %}
{% block styles %}
{{super()}}
<script src="{{ bower_url_for('jquery', filename='dist/jquery.js') }}"></script>
<link rel="stylesheet" href="{{ bower_url_for('blueimp-file-upload', filename='css/jquery.fileupload.css') }}">
<link rel="stylesheet" href="{{ bower_url_for('blueimp-file-upload', filename='css/jquery.fileupload-ui.css') }}">
<link rel="stylesheet" href="{{ bower_url_for('bootstrap-table', filename='dist/bootstrap-table.min.css')}}">
<script src="{{bower_url_for('bootstrap-table', filename='dist/bootstrap-table.min.js')}}"></script>
<script src="{{bower_url_for('bootstrap-table', filename='dist/extensions/export/bootstrap-table-export.js')}}"></script>
<script src="//rawgit.com/kayalshri/tableExport.jquery.plugin/master/tableExport.js"></script>
<script src="//rawgit.com/kayalshri/tableExport.jquery.plugin/master/jquery.base64.js"></script>
<link href="http://cdn.pydata.org/bokeh/release/bokeh-0.12.0.min.css" rel="stylesheet" type="text/css">
<script src="http://cdn.pydata.org/bokeh/release/bokeh-0.12.0.min.js"></script>
<link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
<script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
<!-- Google Font: Open Sans -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,600,600italic,800,800italic">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oswald:400,300,700">
<link rel="stylesheet" href="{{ url_for('.static', filename='css/mvpready-landing.css') }}">
<link rel="stylesheet" href="{{ url_for('.static', filename='css/mystyle.css') }}">
{% endblock %}

{% block head %}
{{super()}}
{% if plot_resources %}
{{ plot_resources|indent(4)|safe }}
{{ plot_script|indent(4)|safe }}
{% endif %}
{% endblock %}

{% block content %}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<nav class="navbar navbar-default">
   <div class="container" >
      <div class="navbar-header">
         <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
         <span class="sr-only">Toggle navigation</span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         <span class="icon-bar"></span>
         </button>
         <a class="navbar-brand" href="#">FUSED-Wind GUI</a>
      </div>
      <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
         <ul class="nav navbar-nav">
            <li><a href="/">Home<span class="sr-only">(current)</span></a></li>
            <li class="active"><a href="configure.html">Perform Analysis</a></li>
            <li><a href="documentation.html">Documentation</a></li>
            <li><a href="about.html"> About </a></li>
         </ul>
         <ul class="nav navbar-nav navbar-right">
            <li><a href="https://github.com/FUSED-Wind/fusedwind-gui">Github</a></li>
         </ul>
      </div>
   </div>
</nav>
<div class="container banner webGUI">
<div class="container-fluid" id="navigation-bar"></div>
<!-- ################### Main Content ################### -->
<div class="container" id="maincontent">
{%- if not sens_flag %}
  <h1>  Individual Analysis </h1>
{%- else %}
  <h1> Sensitivity Analysis </h1>
{%- endif %}
<div id="alert_placeholder">

<!-- display any flashed messages -->
{% if messages %}
<div id="alertdiv" class="alert alert-success" role="alert" >
  <a class="close" data-dismiss="alert">×</a>
  <span> 
    {{messages}} 
  </span>
</div>
{% endif %}

<!-- display a failed run message if present -->
{% if failed_run_flag %}
<script>
   // console.log(' {{ failed_run_flag }} ');
   // window.alert(' {{ failed_run_flag }} ');
   $('#alert_placeholder').append('<div id="alertdiv" class="alert alert-danger' +
                                      '" role="alert"><a class="close" data-dismiss="alert">×</a><span>' +
                                      ' {{ failed_run_flag }} ' +
                                      '</span></div>')
</script>
{% endif %}

</div>
<!-- end display any flashed messages -->

<div class="panel panel-default">
<div class="panel-body" id='button-panel'>
  <input  class="btn btn-mvp" id="submit"  name="submit" type="submit" onClick="submitForms();" value="Run">

   {%- if not sens_flag %}
   <span class="btn btn-mvp fileinput-button">
   <i class="glyphicon glyphicon-plus"></i>
   <span>Load inputs</span>
   <input id="fileupload" type="file" name="files[]" multiple >
   </span>
   {%- endif %}
   {%- if outputs %}
   <div class="btn-group">
      <button type="button"  id="save" class="btn btn-mvp nohover" >Save</button>
      <button type="button" id="save_toggle" class="btn btn-mvp dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      <span class="caret"></span>
      <span class="sr-only">Toggle Dropdown</span>
      </button>
      <ul class="dropdown-menu">
         {%- if not sens_flag %}
         <li><a href="#" onClick='document.getElementById("download-inputs-form").submit()'>Save inputs</a></li>
         <li><a href="#" id='recorder' onClick="record_case();">Record case</a></li>
         <li><a href="#" id='clear-recorder' onClick="clear_recorder();">Clear recorder</a></li>
         <li><a href="#" onClick='document.getElementById("download-full-model").submit()'>Save results</a></li>
         {%- else %}
         <li><a href="#" onClick='document.getElementById("download-sensitivity-results").submit()'>Results (CSV)</a></li>
         {%- endif %}
      </ul>
   </div>
   {% endif %}

   {%- if outputs and not sens_flag %}
   <div class="btn-group pull-right" id="myTabs">
      <ul class="nav nav-tabs" role="tablist">
        {% if not toggle %}
         <li role="presentation">
         {% else %}
         <li role="presentation" class="active">
         {% endif %}
            <a href="#inputs" 
               role="tab" 
               onClick="document.getElementById('hideaway2').style.display='none';
               document.getElementById('hideaway3').style.display='none';
               document.getElementById('hideaway').style.display='none';
               $('#assembly-tree').treeview('selectNode',[0, {silent: false}]);
               " data-toggle="tab">Inputs</a>
         </li>
         {% if not toggle %}
         <li role="presentation" class="active">
         {% else %}
         <li role="presentation">
         {% endif %}
            <a href="#results" role="tab" 
               onClick="document.getElementById('hideaway').style.display='block';
               document.getElementById('hideaway2').style.display='none';
               document.getElementById('hideaway3').style.display='none';
               " data-toggle="tab">Results</a>
         </li>
         <li role="presentation">
            <a href="#plots" role="tab" 
               onClick="document.getElementById('hideaway').style.display='none';
               document.getElementById('hideaway2').style.display='block';
               document.getElementById('hideaway3').style.display='none';
               $('#assembly-tree').treeview('selectNode',[0, {silent: false}]);" data-toggle="tab">Plots</a>
         </li>
         <li role="presentation">
            <a href="#compare" role="tab" 
               onClick="document.getElementById('hideaway').style.display='none';
               document.getElementById('hideaway2').style.display='none';
               document.getElementById('hideaway3').style.display='block';
               $('#assembly-tree').treeview('selectNode',[0, {silent: false}]);" data-toggle="tab">Compare Results</a>
         </li>
      </ul>
   </div>
  {% elif sens_flag and draw_sens_plot %}
  <div class="btn-group pull-right" id="myTabs">
    <ul class="nav nav-tabs" role="tablist">
      <li role="presentation">
        <a href="#inputs",
           role="tab"
           onClick="$('#sensitivityPlots').hide();
           $('#inputs').show();"
           data-toggle="tab"> Inputs </a>
           </li>
      <li role="presentation" class="active">
        <a href="#sensitivityPlots" role="tab"
 onClick="$('#sensitivityPlots').show();
           $('#inputs').hide();" 
                  data-toggle="tab"> Plot </a>
      </li>
    </ul>
  </div>
   {%- endif %}
   <form id="download-inputs-form" method="get" action="/analysis/download"></form>
   <form id="download-full-model"  method="get" action="/analysis/download_full"></form>
   <form id="download-sensitivity-results"  method="get" action="/analysis/download_sensitivity_results"></form>
</div>


<!-- ################### divider to rest of content ################### -->
<div class="panel-body">
<div class="row" id="input_panels">
<!-- ########################## The Description panel ############## -->
<div class="col-xs-3">
   <div class="panel-body">
      <div class="panel panel-default" id='panel-'>
         <div class="panel-heading">
            <h3 class="panel-title">Model Description</h3>
         </div>
         <div class="panel-body">
            <p>{{desc}}</p>
            <p></p>
            {%- if sens_flag %}
            {%- if not tornado_flag %}
            <p>For the sensitivity analysis, please specify all input values as well as which analysis parameters and their low and high values.</p>
            <p>For a tornado plot, first select the tornado plot sensitivity type then select the parameters you want to vary and input a % deviation from the Initial Value that you would like to test.
            </p>
            {% else %}
            <p>
            The green color and upward arrow indicate the value of an output after the parameter is increased; red, downward arrow indicates the value of an output after the parameter is decreased.
            </p> 
            {% endif %}
            {%- else %}
            <p>For the individual analysis, please specify all input values.</p>
            {%- endif %}
         </div>
      </div>
   </div>
   <!-- ########################## The Assembly navigation panel ############## -->
   {%- if outputs and not sens_flag %}
   <div class="panel-body" id="hideaway2">
      <div class="panel panel-default">
         <div class="panel-heading">
            <h3 class="panel-title"> Choose Plot </h3>
         </div>
         <div class="btn-group">
            <ul class="nav nav-pills nav-justified" id="plotTabs" role="tablist">
               <li role="presentation" class="active">
                  <a href="#CAPEX" role="tab" onClick="
                     document.getElementById('CAPEX').style.display='block';
                     document.getElementById('LCOE').style.display='none';" data-toggle="tab">CAPEX</a>
               </li>
               <li role="presentation">
                  <a href="#LCOE" role="tab" onClick="
                     document.getElementById('LCOE').style.display='block';
                     document.getElementById('CAPEX').style.display='none';" data-toggle="tab">LCOE</a>
               </li>
            </ul>
         </div>
      </div>
   </div>
   <div class="panel-body" id="hideaway3">
      <div class="panel panel-default">
         <div class="panel-heading">
            <h3 class="panel-title"> Instructions </h3>
         </div>
         <div class="panel-body">
            <p> Record the cases you want to compare by selecting "Record Case" under the Save dropdown menu or turning on the "Record Case" toggle in the inputs form.</p>
         </div>
      </div>
   </div>
   <div class="panel-body" id="hideaway">

      <div class="panel panel-default" id='panel-'>
         <div class="panel-heading">
            <h3 class="panel-title">
               <a data-target="#collapse-tree"
                  href="#collapse-tree" >
               System Hierarchy
               </a>
            </h3>
         </div>
         <div id="assembly-tree"></div>
      </div>
   </div>
   {%- endif %}            
</div>


<div class="tab-content">
   {%- if outputs and not sens_flag %}
   <div role="tabpanel" class="tab-pane" id="compare">
      <div class="col-md-9">
         <div class="panel-body comp-panels panel-{{name}}">
            <div class="panel panel-default">
               <div class="panel-heading">
                  <h3 class="panel-title">Compare Results</h3>
               </div>
               <div id="plot_area" class="panel-body", align="center">
                  <div id="plot_base">
                     <div class="row" id="plot_row">
                        <div class="col-md-3">
                           <div class="row">
                              <div class="col-md-9 col-md-offset-2">
                                 <form id="plot_controller__compare">
                                    <div class="form-group">
                                       <label for="input_plot_variable">Input</label>
                                       <select class="form-control" id="input_plot_variable">
                                          <optgroup label="Choose Input">
                                             {% for val in plot_inputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    <div class="form-group">
                                       <label for="output_plot_variable">Output</label>
                                       <select class="form-control" id="output_plot_variable">
                                          <optgroup label="Choose Output">
                                             {% for val in plot_outputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    <button type="submit" class="btn btn-success">Plot</button>
                                 </form>
                              </div>
                           </div>
                        </div>
                        <!-- start plot -->
                        <div class="col-md-9" id="plot_space">
                          {{ plot_script_comp|indent(4)|safe }}
                          {{ plot_div_comp|indent(4)|safe }}
                        </div>
                        <!-- end plot -->
                        <script type="text/javascript">
                           $("form#plot_controller__compare").submit( function(event) {
                               event.preventDefault();
                               compare_results();
                               var topDOM = $(this).closest("div#plot_row");
                               var plotDOM = topDOM.find("div#plot_space");
                               var inVar = $(this).find("#input_plot_variable").find("option:selected").text();
                               var outVar = $(this).find("#output_plot_variable").find("option:selected").text();
                               $.post( "/compare_results", { inVar: inVar, outVar: outVar} , function(data){
                                   plotDOM.html( data.script + data.div );
                           
                               });
                           });
                        </script>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </div>
   {%- endif %}

   {%- if not sens_flag %}
   <div role="tabpanel" class="tab-pane" id="plots">
   {%- endif %}
      <!-- ########################## The Plotting Panel ############################# -->
      {% if draw_plot %}
      <div class="tab-content">
         <div role="tabpanel" class="tab-pane active" id="CAPEX">
            <div class="col-xs-9">
               <div class="panel-body comp-panels panel-{{name}}">
                  <div class="panel panel-default">
                     <div class="panel-heading">
                        <h3 class="panel-title">CAPEX Plot</h3>
                     </div>
                     <div class="panel-body", align="center">
                        <div id="plot_space">
                           {{ plot_script|indent(4)|safe }}
                           {{ plot_div|indent(4)|safe }}
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
         <div role="tabpanel" class="tab-pane"  id="LCOE">
            <div class="col-xs-9">
               <div class="panel-body comp-panels panel-{{name}}">
                  <div class="panel panel-default">
                     <div class="panel-heading">
                        <h3 class="panel-title">LCOE Plot</h3>
                     </div>
                     <div class="panel-body", align="center">
                        <div id="plot_space">
                           {{ plot_script_lcoe|indent(4)|safe }}
                           {{ plot_div_lcoe|indent(4)|safe }}
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      {% endif %}

      {% if draw_sens_plot %}
      <div class="tab-content">
      <div role="tabpanel" class="tab-pane active" id="sensitivityPlots">
      <div class="col-md-9">
         <div class="panel-body comp-panels panel-{{name}}">
            <div class="panel panel-default">
               <div class="panel-heading">
                  <h3 class="panel-title" >Results</h3>
                  <div class="btn-group pull-right" role="group" aria="...">
                     <button type="button" id="addPlotWindow-btn" class="btn-small btn-success">Add Plot Window</button>
                  </div>
               </div>
                {% if tornado_flag %}
                <div id="plot_area" class="panel-body", align="center">
                  <div id="plot_base">
                     <div class="row" id="plot_row">
                        <div class="col-md-3">
                           <div class="row">
                              <div class="col-md-9 col-md-offset-2">
                                 <form id="plot_controller__tornado">

                                    <div class="form-group">

                                       <label for="output_plot_variable">Output</label>
                                       <select class="form-control" id="output_plot_variable">
                                          <optgroup label="Choose Output">
                                             {% for val in plot_outputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    
                                    <button type="submit" class="btn btn-default btn-success" >Plot</button>
                                 </form>
                              </div>
                           </div>
                        </div>
                        <!-- start plot -->
                        <div class="col-md-9" id="plot_space">
                           {{ plot_script|indent(4)|safe }}
                           {{ plot_div|indent(4)|safe }}
                        </div>
                        <!-- end plot -->
                        <script type="text/javascript">
                           $("form#plot_controller__tornado").submit( function(event) {
                               event.preventDefault();
                               var topDOM = $(this).closest("div#plot_row");
                               var plotDOM = topDOM.find("div#plot_space");
                               var outVar = $(this).find("#output_plot_variable").find("option:selected").text();
                               $.post( "/tornado", { outVar: outVar } , function(data){
                                   plotDOM.html( data.script + data.div );
                               });
                           });
                        </script>
                     </div>
                  </div>
                  <!-- Plot Controller Action -->
                  <script type="text/javascript">
                     var plotCount = 0;
                     
                     var addPlotWindow = function(){
                         plotCount += 1;
                     
                         var rawText = $("#plot_base").html();
                         rawText = rawText.replace(/__0/g, "__" + plotCount);
                     
                         var plotText = rawText.substring(0,rawText.indexOf("<!-- start plot -->"));
                     
                         plotText += '<div class="col-md-9" id="plot_space"></div>';
                     
                         plotText += rawText.substring(rawText.indexOf("<!-- end plot -->") + 17);
                     
                         $("#plot_area").append(plotText);
                         console.log(plotText);
                     }
                     
                     
                     $("#addPlotWindow-btn").click( function(){
                         addPlotWindow();
                     });
                     
                  </script>
               </div>

                {% else %}
               <div id="plot_area" class="panel-body", align="center">
                  <div id="plot_base">
                     <div class="row" id="plot_row">
                        <div class="col-md-3">
                           <div class="row">
                              <div class="col-md-9 col-md-offset-2">
                                 <form id="plot_controller__0">
                                 
                                    <div class="form-group">
                                       <label for="input_plot_variable">Input</label>
                                       <select class="form-control" id="input_plot_variable">
                                          <optgroup label="Choose Input">
                                             {% for val in plot_inputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    <div class="form-group">
                                       <label for="output_plot_variable">Output</label>
                                       <select class="form-control" id="output_plot_variable">
                                          <optgroup label="Choose Output">
                                             {% for val in plot_outputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    <div class="form-group">
                                       <label for="color_plot_variable">Colors</label>
                                       <select class="form-control" id="color_plot_variable">
                                          <option>Mono</option>
                                          <optgroup label="Inputs">
                                             {% for val in plot_inputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                          <optgroup label="Outputs">
                                             {% for val in plot_outputVars %}
                                             <option>{{val}}</option>
                                             {% endfor %}
                                          </optgroup>
                                       </select>
                                    </div>
                                    <button type="submit" class="btn btn-default btn-success" >Plot</button>
                                 </form>
                              </div>
                           </div>
                           <h3 id="summary_heading">Summary</h3>
                           <!-- Plot summary goes here -->
                           <div id="plot_summary">
                              <p>No inputs selected</p>
                           </div>
                        </div>
                        <!-- start plot -->
                        <div class="col-md-9" id="plot_space">
                           {{ plot_script|indent(4)|safe }}
                           {{ plot_div|indent(4)|safe }}
                        </div>
                        <!-- end plot -->
                        <script type="text/javascript">
                           $("form#plot_controller__0").submit( function(event) {
                               event.preventDefault();
                           
                               var topDOM = $(this).closest("div#plot_row");
                           
                               var summaryDOM = topDOM.find("div#plot_summary");
                               var plotDOM = topDOM.find("div#plot_space");
                           
                           
                               var inVar = $(this).find("#input_plot_variable").find("option:selected").text();
                               var outVar = $(this).find("#output_plot_variable").find("option:selected").text();
                               var colVar = $(this).find("#color_plot_variable").find("option:selected").text();
                           
                               $.post( "/RetrieveSensPlot", { inVar: inVar, outVar: outVar, colVar:colVar } , function(data){
                                   plotDOM.html( data.script + data.div );
                                   summaryDOM.html( data.summary );
                               });
                           });
                        </script>
                     </div>
                  </div>
                  <!-- Plot Controller Action -->
                  <script type="text/javascript">
                     var plotCount = 0;
                     
                     var addPlotWindow = function(){
                         plotCount += 1;
                     
                         var rawText = $("#plot_base").html();
                         rawText = rawText.replace(/__0/g, "__" + plotCount);
                     
                         var plotText = rawText.substring(0,rawText.indexOf("<!-- start plot -->"));
                     
                         plotText += '<div class="col-md-9" id="plot_space"></div>';
                     
                         plotText += rawText.substring(rawText.indexOf("<!-- end plot -->") + 17);
                     
                         $("#plot_area").append(plotText);
                         console.log(plotText);
                     }
                     $("#addPlotWindow-btn").click( function(){
                         addPlotWindow();
                     });
                     
                  </script>
               </div>
               {% endif %}
            </div>
         </div>
      </div>
      </div>
      </div>
      {% endif %}

      {%- if not sens_flag %}
   </div>
   {%- endif %}
   <!--                         The Inputs Panel                            -->
   {% if not sens_flag %}
   {% if not outputs %}
   <div role="tabpanel" class="tab-pane active" id="inputs">
   {% else %}
   {% if not toggle %}
   <div role="tabpanel" class="tab-pane" id="inputs">
   {% else %}
   <div role="tabpanel" class="tab-pane active" id="inputs">
   {% endif %}
   {% endif %}
      <div class="col-xs-9" id='inputs_single'>
         <div class="panel-body">
            <form method="post" class="form" id='global-inputs-form'>
               <div class="panel panel-group" id="accordion" role="tablist" area-multiselectable="true">
                  {%- for group in group_list %}
                  <div class="panel panel-default">
                     <div class="panel-heading" role="tab" id="headingOne">
                        <h3 class="panel-title">
                           <a role="button" data-toggle="collapse" href="#collapse{{group}}" aria-expanded="true" aria-controls="collapse{{group}}">
                           {{group}} Inputs
                           </a>
                        </h3>
                     </div>
                     {%- if group == 'Global' %}
                     <div id="collapse{{group}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading{{group}}">
                        {%- else %}
                        <div id="collapse{{group}}" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="heading{{group}}">
                           {%- endif %}
                           <div class="panel-body"
                              align="center" id='global-inputs-panel'>
                              {{ inputs.hidden_tag() }}
                              {{ wtf.form_errors(inputs, hiddens='only') }}
                              <table class="table table-hover" align="left">
                                 <col width="55%">
                                 <col width="45%">
                                 {%- if group == 'Global' %}
                                 <tr> 
                                  <td> Record Case </td> <td> 
                                  {% if toggle %}
                                  <input id="toggle-button" type="checkbox" class="form-control"  
                                  name="toggle_record" checked data-toggle="toggle"> 
                                  {% else %}
                                  <input id="toggle-button" type="checkbox" class="form-control"  
                                  name="toggle_record" data-toggle="toggle"> 
                                  {% endif %}
                                  </td>
                                 </tr>
                                 {% endif %}

                                 <tr>
                                    <th>Parameter</th>
                                    <th>Value</th>
                                 </tr>
                                 {%- for field in inputs %}
                                 {%- if field.name not in ('csrf_token', 'submit') %}
                                 {%- if group_dic[field.name] == group %}
                                 <tr>
                                    <td>{{field.description}} ({{field.name}})</td>
                                    <td>
                                       <div id='trigger-{{field.name|safe}}'>
                                          {{field(class="form-control")|safe}}
                                       </div>
                                    </td>
                                 </tr>
                                 {%- endif %}
                                 {%- endif %}
                                 {%- endfor %}
                              </table>
                           </div>
                        </div>
                     </div>
                     {%- endfor %}
                     <script>
                        function getHeight() {
                            var h_nav = document.getElementById('navigation-bar').offsetHeight;
                            var h_btn = document.getElementById('button-panel').offsetHeight;
                            var h_win = $(window).height() - h_nav - h_btn - 50;
                            return String(h_win)+'px'
                        }
                            console.log(getHeight())
                            document.getElementById ( "global-inputs-panel" ).style.maxHeight = getHeight();
                            document.getElementById ( "global-inputs-panel" ).style.overflowY = "scroll";
                     </script>
                  </div>
            </form>
            </div>
         </div>
      </div>
      {%- else %}
      <!-- if sens flag  -->
      <div class="tab-content">
      {% if draw_sens_plot %}
      <div role="tabpanel" class="tab-pane" id="inputs">
      {% else %}

      <div role="tabpanel" class="tab-pane active" id="inputs">
      {% endif %}

      {%- if draw_sens_plot %}
      <div class="col-xs-9" id='inputs_single'>
         {%- else %}
         <div class="col-xs-9" id='inputs_single'>
            {%- endif %}
            <div class="panel-body">
               <form method="post" class="form" id='global-inputs-form'>
                  <div class="panel panel-group" id="accordion" role="tablist" area-multiselectable="true">
                     <div class="panel panel-default">
                        <div class="panel-heading" role="tab" id="headingOne">
                           <h3 class="panel-title">
                              <a role="button" data-toggle="collapse" href="#collapseSensitivity" aria-expanded="true" aria-controls="collapseSensitivity">
                              Sensitivity Inputs
                              </a>
                           </h3>
                        </div>
                        <div id="collapseSensitivity" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="headingSensitity">
                              <div class="panel-body" align="center" id='sensitivity-inputs-panel'>
                                 {{ inputs.hidden_tag() }}
                                 {{ wtf.form_errors(inputs, hiddens='only') }}
                                 <table class="table table-hover" align="left">
                                    <tr>
                                       <th>Parameter</th>
                                       <th>Sensitivity Type</th>
                                       <th>Initial Value</th>
                                    </tr>
                                    <tr>
                                       <td>Number of Iterations in Sensitivity Analysis (iteration_count)</td>
                                       <td>
                                        <div id='trigger-select.sens'>
                                          <input type="radio" class="form-control" value="n" name="select.alpha" checked 
                                          onClick="
                                          $('.hideaway4').show();
                                          $('.hideaway5').show();
                                          $('.hideaway6').show();
                                          $('.hideaway7').show();">
                                         </div>
                                      </td>
                                       <td>
                                          <div id='trigger-iteration_count'>
                                             <input type="text" class="form-control" value="{{ extra_inputs['sensitivity_iterations']}}" name="iteration_count">
                                          </div>
                                       </td>
                                    </tr>
                                    <tr>
                                      <td> Tornado Plot Variability (%) </td>
                                      <td>
                                        <div id='trigger-select.alpha'>
                                          <input type="radio" class="form-control" value="y" name="select.alpha" onClick="
                                          $('.hideaway4').hide();
                                          $('.hideaway5').hide();
                                          $('.hideaway6').hide();
                                          $('.hideaway7').hide();
                                          ">
                                         </div>
                                      </td>
                                    <td>  
                                        <div id='trigger-alpha'>
                                          <input type="text" class="form-control" value="{{extra_inputs['alpha']}}" name="alpha">
                                         </div>
                                     </td>
                                    </tr>
                                 </table>
                              </div>
                           </div>
                        </div>
                        {%- for group in group_list %}
                        <div class="panel panel-default">
                           <div class="panel-heading" role="tab" id="headingOne">
                              <h3 class="panel-title">
                                 <a role="button" data-toggle="collapse" href="#collapse{{group}}" aria-expanded="true" aria-controls="collapse{{group}}">
                                 {{group}} Inputs
                                 </a>
                              </h3>
                           </div>
                           {%- if group == 'Global' %}
                           <div id="collapse{{group}}" class="panel-collapse collapse in" role="tabpanel" aria-labelledby="heading{{group}}">
                            
                                 {%- else %}
                                 <div id="collapse{{group}}" class="panel-collapse collapse out" role="tabpanel" aria-labelledby="heading{{group}}">
                                    {%- endif %}
                                    <div class="panel-body"
                                       align="center" id='global-inputs-panel'>
                                       {{ inputs.hidden_tag() }}
                                       {{ wtf.form_errors(inputs, hiddens='only') }}
                                       <table class="table table-hover" align="left">
                                          <tr>
                                             <th>Parameter</th>
                                             <th id="initial_values">Initial Value</th>
                                             <th>Sensitivity Input</th>
                                             <th class="hideaway4">Sensitivity Low Value</th>
                                             <th class="hideaway5">Sensitivity High Value</th>
                                          </tr>
                                          {%- for field in inputs %}
                                          {%- if ('select.' not in field.name) and ('low.' not in field.name) and ('high.' not in field_name) %}
                                          {%- if field.name not in ('csrf_token', 'submit') and group_dic[field.name] == group %}
                                          <tr>
                                             <td>{{field.description}} ({{field.name}})</td>

                                              <!-- Initial Values  -->
                                             <td>
                                                <div id='trigger-{{field.name|safe}}'>
                                                   {{field(class="form-control")|safe}}
                                                </div>
                                             </td>

                                             <!-- Must be the units.. or a check box  --> 
                                             <td>
                                                {%- for select_field in inputs %}
                                                {%- if ('select.'+field.name == select_field.name) %}
                                                <div id='trigger-{{select_field.name|safe}}'>
                                                   {{select_field(class="form-control")|safe}}
                                                </div>
                                                {%- endif %}
                                                {%- endfor %}
                                             </td>

                                             <td class="hideaway6">
                                                {%- for low_field in inputs %}
                                                {%- if ('low.'+field.name == low_field.name) %}
                                                <div id='trigger-{{low_field.name|safe}}'>
                                                   {{low_field(class="form-control")|safe}}
                                                </div>
                                                {%- endif %}
                                                {%- endfor %}
                                             </td>
                                             <td class="hideaway7">
                                                {%- for high_field in inputs %}
                                                {%- if ('high.'+field.name == high_field.name) %}
                                                <div id='trigger-{{high_field.name|safe}}'>
                                                   {{high_field(class="form-control")|safe}}
                                                </div>
                                                {%- endif %}
                                                {%- endfor %}
                                             </td>
                                          </tr>
                                          {%- endif %}
                                          {%- endif %}
                                          {%- endfor %}
                                       </table>
                                    </div>
                                 </div>
                              </div>
                              {%- endfor %}
                              <script>
                                 function getHeight() {
                                     var h_nav = document.getElementById('navigation-bar').offsetHeight;
                                     var h_btn = document.getElementById('button-panel').offsetHeight;
                                     var h_win = $(window).height() - h_nav - h_btn - 50;
                                     return String(h_win)+'px'
                                 }
                                     console.log(getHeight())
                                     document.getElementById ( "global-inputs-panel" ).style.maxHeight = getHeight();
                                     document.getElementById ( "global-inputs-panel" ).style.overflowY = "scroll";
                              </script>
                           </div>
               </form>
               </div>
               </div>
               </div>
               </div>
               {%- endif %}
               <!-- ###################### The Outputs panel ########################### -->
               {%if not sens_flag%}
               {% if outputs %} <!-- Only show the outputs panel if there are outputs to show -->
               {% if not toggle %}
               <div role="tabpanel" class="tab-pane active" id="results">
               {% else %}
               <div role="tabpanel" class="tab-pane" id="results">
               {% endif %}
               <div class="col-xs-9">
               <div id="topLevel" class="panel panel-body  comp-panels panel-{{name}}">
               <div class="panel panel-default">
               <div class="panel-heading">
               <h3 class="panel-title">Model Output Results and Current Input States</h3>
               </div>
               <div class="panel-body", align="center">
               <table class="table col-xs-9"
                  id="global-outputs-table"
                  data-toggle="global-outputs-table"
                  data-show-columns="true"
                  data-search="true"
                  data-show-refresh="true"
                  data-show-toggle="true"
                  data-show-export="true"
                  data-detail-view="true">
               <thead>
               <tr>
               <th data-field="name">Name</th>
               <th data-field="desc">Description</th>
               <th data-field="state" data-formatter='validateOutputs'>Value</th>
               <th data-field="units">Units</th>
               <th data-field="iotype">I/O Type</th>
               </tr>
               </thead>
               </table>
               </div>
               </div>
               <script>
                  window['global-outputs-data'] = {{ outputs | tojson | safe }};
                  $('#global-outputs-table').bootstrapTable({data: window['global-outputs-data'],
                                                             height: getHeight(),
                                                             onExpandRow: function (index, row, $detail) {
                                                             expandTable($detail, row);
                                                             }
                                                            });
                  function validateOutputs(value, row) {
                      if (row.type == 'Array') {
                          return 'Array data';
                      }
                      else if (row.type == 'VarTree') {
                          return 'Vartree data';
                      }
                      else if (row.type == 'Float'){
                          return row.state.toPrecision(5);
                      }
                      else {
                          return row.state;
                      }
                  }
                  function getHeight() {
                      var h_nav = document.getElementById('navigation-bar').offsetHeight;
                      var h_btn = document.getElementById('button-panel').offsetHeight;
                      console.log(h_nav, h_btn)
                      return $(window).height() - h_nav - h_btn - 50;
                  }
               </script>
               </div>
               </div>
               </div>
               {% endif %}
               {% endif %}
               {% if sub_comp_data %}
               {% for field, inout in sub_comp_data.iteritems() %}
               <div class="panel-body hidden col-xs-9 comp-panels not_lcoe panel-{{field}}">
               <!-- ############## The Component Input panel ############################## -->
               <div class="panel panel-default">
               <div class="panel-heading">
               <h3 class="panel-title">{{field}}</h3>
               </div>
               <div class="panel-heading">Inputs & Outputs</div>
               <div class="panel-body", align="center">
               <table class="table"
                  id="{{field}}-table"
                  data-toggle="{{field}}-table"
                  data-show-columns="true"
                  data-search="true"
                  data-show-refresh="true"
                  data-show-toggle="true"
                  data-show-export="true"
                  data-detail-view="true">
               <thead>
               <tr>
               <th data-field="name">Name</th>
               <th data-field="desc">Description</th>
               <th data-field="state" data-formatter='validateOutputs'>Current Value</th>
               <th data-field="units">Units</th>
               <th data-field="iotype">I/O Type</th>
               </tr>
               </thead>
               </table>
               </div>
               </div>
               <script>
                  window['{{field}}-data'] = {{ inout['params'] | tojson | safe }};
                  $('#{{field}}-table').bootstrapTable({data: window['{{field}}-data'],
                                                        height: getHeight(),
                                                        onExpandRow: function (index, row, $detail) {
                                                            expandTable($detail, row);
                                                        }
                                                       });
                  function validateOutputs(value, row) {
                      if (row.type == 'Array') {
                          return 'Array data';
                      }
                      else if (row.type == 'VarTree') {
                          return 'Variable Collection';
                      }
                      else {
                          return row.state;
                      }
                  }
                  function getHeight() {
                      var h_nav = document.getElementById('navigation-bar').offsetHeight;
                      var h_btn = document.getElementById('button-panel').offsetHeight;
                      return $(window).height() - h_nav - h_btn - 50;
                  }
               </script>
               {% if inout.plot %}
               <div class="panel-body", align="center">
               {{ inout.plot.script|indent(4)|safe }}
               {{ inout.plot.div|indent(4)|safe }}
               </div>
               {% endif %}
               </div>
               {% endfor %}
               {% endif %}
               </div>
            </div>
         </div>
      </div>
   </div>
</div>
{% endblock %}

{% block scripts %}
{{super()}}
<script src="{{ bower_url_for('bootstrap-treeview', filename='src/js/bootstrap-treeview.js') }}"></script>
<script src="{{ bower_url_for('blueimp-file-upload', filename='js/vendor/jquery.ui.widget.js') }}"></script>
<script src="{{ bower_url_for('blueimp-file-upload', filename='js/jquery.iframe-transport.js') }}"></script>
<script src="{{ bower_url_for('blueimp-file-upload', filename='js/jquery.fileupload.js') }}"></script>
<!-- Some javascript goes into main.js because they are dynamic and have jinja2 template engine associated. Others that are actually static go into myjs.js in the static/js folder -->
<script type="text/javascript">
    {% include "main.js" %}
</script>
<script src="{{ url_for('.static', filename='js/myjs.js') }}" > </script>
{% endblock %}